using Common.Interfaces.System;
using Common.Interfaces.Test;
using IoTTestOrchestrator;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using RestServer;
using ScenarioBuilder.Implementations.Configuration;
using System;
using System.IO;
using System.Linq;

namespace Cmf.Custom.Tests.IoT.Tests
{
    [TestClass]
    public class MTConnect
    {
        private const string PACKAGES_LOCATION = @"c:\IoT\Repository";
        private const string MANAGER = @"criticalmanufacturing-connect-iot-manager-11.1.7-dev.tgz";
        private const string MASTERDATA = @"1.0.0/DemoMTController.json";

        private ScenarioConfiguration? Configuration;
        private int PORT;

        /// <summary>
        /// Initializes the test scenario configuration.
        /// </summary>
        [TestInitialize]
        public void Initialize()
        {
            PORT = new Random().Next(5000, 30000);
            File.WriteAllText(MASTERDATA, File.ReadAllText(MASTERDATA).Replace("__DEFAULTPORT__", PORT.ToString()));

            Configuration = new ScenarioConfiguration()
             //Configure IoT Manager
             .ManagerId("MTConnectManager")
             .WriteLogsTo(@"C:\IoT\logs.txt")
             .Config(new Common.Objects.Config.ConfigBuilder()
                 .CacheLocation(Path.GetTempPath())
                 .Build())
             // Settings for starting IoT manager
             .StartMode<LocalStartMode.PluginMain>(new LocalStartMode.Plugin.SettingsBuilder()
                 .ManagerLocation(Path.Join(PACKAGES_LOCATION, MANAGER))
                 .Build())
             // Configure MES Mock System 
             .SystemPlugin<MockSystem.PluginMain>(new MockSystem.Plugin.SettingsBuilder()
                 .Repository(PACKAGES_LOCATION)
                 .MasterdataPath(MASTERDATA)
                 .AddSite("TestSite")
                 .AddManager("MTConnectManager")
                 .AddControllerInstance("Demo MTConnect Controller [A.1]", "MTConnectManager", "TestSite")
                 .AddDriverInstance("Demo MTConnect Controller [A.1]", "MTConnect", "MTConnectManager", "TestSite")
                 .Build())
             // Configure the equipment simulator
             .AddSimulatorPlugin<RestServer.PluginMain>(new RestServer.Plugin.SettingsBuilder()
                 .Address("http://127.0.0.1", PORT)
                 .Build());
        }

        [TestCleanup]
        public void Cleanup()
        {
            File.WriteAllText(MASTERDATA, File.ReadAllText(MASTERDATA).Replace(PORT.ToString(), "__DEFAULTPORT__"));
        }

        [TestMethod]
        public void ConnectToMTConnect()
        {
            new TestScenario(Configuration).Run((scenario, context) =>
            {
                #region Setup

                var system = (MockSystem.PluginMain)context.System;
                var restSimulator = (RestServer.PluginMain)context.Simulators["RestServer"];

                restSimulator.Register("/Mazak/probe", (ISystemRequest request) =>
                {
                    return DefaultProbeReply();
                }, Common.Objects.Rest.RestVerb.Get);

                restSimulator.Register("/Mazak/current", (ISystemRequest request) =>
                {
                    return DefaultCurrentReply();
                }, Common.Objects.Rest.RestVerb.Get);

                system.WaitForAllComunicating(20);

                var controller = (IControllerInstanceContext)context.Instances["Controller"];

                #endregion Setup
            });
        }

        [TestMethod]
        public void ConnectToMTConnect_ProbeEvent()
        {
            new TestScenario(Configuration).Run((scenario, context) =>
            {
                #region Setup

                var system = (MockSystem.PluginMain)context.System;
                var restSimulator = (RestServer.PluginMain)context.Simulators["RestServer"];

                var controllerInstance = context.Instances["Controller"] as IControllerInstanceContext;
                var controllerInstanceLog = (controllerInstance as IInstanceContext).Log;

                var probeRequest = false;
                restSimulator.Register("/Mazak/probe", (ISystemRequest request) =>
                {
                    probeRequest = true;
                    return DefaultProbeReply();
                }, Common.Objects.Rest.RestVerb.Get);

                var currentRequest = false;
                restSimulator.Register("/Mazak/current", (ISystemRequest request) =>
                {
                    currentRequest = true;
                    return DefaultCurrentReply();
                }, Common.Objects.Rest.RestVerb.Get);

                system.WaitForAllComunicating(20);

                #endregion Setup

                scenario.Utilities.WaitFor(50, "No Probe Request Was called", () =>
                {
                    return probeRequest;
                });

                scenario.Utilities.WaitFor(50, "No Current Request Was called", () =>
                {
                    return currentRequest;
                });

                Assert.IsTrue(controllerInstanceLog.Any(log => log.Contains("RECEIVED A PROBE")));
            });
        }

        [TestMethod]
        public void ConnectToMTConnect_CurrentCommand()
        {
            new TestScenario(Configuration).Run((scenario, context) =>
            {
                #region Setup

                var system = (MockSystem.PluginMain)context.System;
                var restSimulator = (RestServer.PluginMain)context.Simulators["RestServer"];

                var controllerInstance = context.Instances["Controller"] as IControllerInstanceContext;
                var controllerInstanceLog = (controllerInstance as IInstanceContext).Log;

                restSimulator.Register("/Mazak/probe", (ISystemRequest request) =>
                {
                    return DefaultProbeReply();
                }, Common.Objects.Rest.RestVerb.Get);

                restSimulator.Register("/Mazak/current", (ISystemRequest request) =>
                {
                    return DefaultCurrentReply();
                }, Common.Objects.Rest.RestVerb.Get);

                system.WaitForAllComunicating(20);

                #endregion Setup

                scenario.Utilities.WaitFor(50, "No Current Request Was called", () =>
                {
                    var msg1 = controllerInstanceLog.Any(log => log.Contains("Current Command|task_1934|equipmentCommand] Successfully executed request command 'connect.iot.driver.template.executeCommand' with Message 'CurrentCommand'."));
                    var msg2 = controllerInstanceLog.Any(log => log.Contains("Current Command|task_1979|logMessage] {\"Header\":{\"InstanceId\":1756395673"));
                    return msg1 && msg2;
                });
            });
        }

        private static SystemReply DefaultProbeReply()
        {
            var reply = new SystemReply(200, "<MTConnectDevices>\n  <Header instanceId=\"1756395673\" version=\"6.7.0.0\" sender=\"NB-5CD242BX56\" bufferSize=\"150000\" assetBufferSize=\"1000\" assetCount=\"0\" deviceModelChangeTime=\"2025-08-28T15:41:13.9985794Z\" creationTime=\"2025-08-28T15:45:47.8484794Z\" />\n  <Devices>\n    <Device id=\"d1\" name=\"Mazak\" uuid=\"5fd88408-7811-3c6b-5400-11f4026b6890\" mtconnectVersion=\"2.5\" hash=\"9cb08f89c551af92903b1f34d9cd5aa35b83ff0a\">\n      <Description manufacturer=\"Mazak_Corporation\" serialNumber=\"304141\">Mill w/SMooth-G</Description>\n      <Configuration>\n        <CoordinateSystems>\n          <CoordinateSystem id=\"basecoord\" type=\"BASE\">\n            <Transformation>\n              <Translation>0 0 0</Translation>\n              <Rotation>0 0 0</Rotation>\n            </Transformation>\n          </CoordinateSystem>\n          <CoordinateSystem id=\"machcoord\" type=\"MACHINE\" parentIdRefd=\"basecoord\">\n            <Transformation>\n              <Translation>0 0 0</Translation>\n              <Rotation>0 0 0</Rotation>\n            </Transformation>\n          </CoordinateSystem>\n          <CoordinateSystem id=\"workcoord\" type=\"TASK\" parentIdRefd=\"machcoord\" />\n          <CoordinateSystem id=\"localcoord\" type=\"OBJECT\" parentIdRefd=\"workcoord\" />\n        </CoordinateSystems>\n        <SolidModel id=\"dm\" solidModelIdRef=\"dm\" href=\"/models/foo.stl\" mediaType=\"STL\" coordinateSystemIdRef=\"machine\">\n          <Scale>2 3 4</Scale>\n        </SolidModel>\n      </Configuration>\n      <DataItems>\n        <DataItem category=\"EVENT\" id=\"avail\" type=\"AVAILABILITY\" />\n        <DataItem category=\"EVENT\" id=\"functionalmode\" type=\"FUNCTIONAL_MODE\" />\n        <DataItem category=\"EVENT\" id=\"emloaded\" type=\"EQUIPMENT_MODE\" subType=\"LOADED\" />\n        <DataItem category=\"EVENT\" id=\"emworking\" type=\"EQUIPMENT_MODE\" subType=\"WORKING\" />\n        <DataItem category=\"EVENT\" id=\"emoperating\" type=\"EQUIPMENT_MODE\" subType=\"OPERATING\" />\n        <DataItem category=\"EVENT\" id=\"empowered\" type=\"EQUIPMENT_MODE\" subType=\"POWERED\" />\n        <DataItem category=\"EVENT\" id=\"emdelay\" type=\"EQUIPMENT_MODE\" subType=\"DELAY\" />\n        <DataItem category=\"EVENT\" id=\"operatingsystem\" type=\"OPERATING_SYSTEM\" />\n        <DataItem category=\"EVENT\" id=\"osmfg\" type=\"OPERATING_SYSTEM\" subType=\"MANUFACTURER\" />\n        <DataItem category=\"EVENT\" id=\"osversion\" type=\"OPERATING_SYSTEM\" subType=\"VERSION\" />\n        <DataItem category=\"EVENT\" id=\"gui\" type=\"APPLICATION\" />\n        <DataItem category=\"EVENT\" id=\"guimfg\" type=\"APPLICATION\" subType=\"MANUFACTURER\" />\n        <DataItem category=\"EVENT\" id=\"guiversion\" type=\"APPLICATION\" subType=\"VERSION\" />\n        <DataItem category=\"EVENT\" id=\"d1_asset_chg\" type=\"ASSET_CHANGED\" discrete=\"True\" />\n        <DataItem category=\"EVENT\" id=\"d1_asset_rem\" type=\"ASSET_REMOVED\" />\n        <DataItem category=\"EVENT\" id=\"d1_assetCount\" name=\"assetCount\" type=\"ASSET_COUNT\" />\n      </DataItems>\n      <Components>\n        <Axes id=\"a\" name=\"base\">\n          <DataItems>\n            <DataItem category=\"CONDITION\" id=\"servo_cond\" type=\"ACTUATOR\" />\n            <DataItem category=\"CONDITION\" id=\"spindle_cond\" type=\"SYSTEM\" />\n          </DataItems>\n          <Components>\n            <Linear id=\"x\" name=\"X\">\n              <Configuration>\n                <Specifications>\n                  <Specification id=\"spec1\" type=\"LOAD\">\n                    <UpperLimit>200</UpperLimit>\n                    <LowerLimit>0</LowerLimit>\n                  </Specification>\n                </Specifications>\n              </Configuration>\n              <DataItems>\n                <DataItem category=\"SAMPLE\" id=\"Xabs\" type=\"POSITION\" subType=\"ACTUAL\" nativeScale=\"100\" nativeUnits=\"MILLIMETER\" units=\"MILLIMETER\" />\n                <DataItem category=\"SAMPLE\" id=\"Xpos\" type=\"POSITION\" subType=\"ACTUAL\" nativeUnits=\"INCH\" units=\"MILLIMETER\">\n                  <Source dataItemId=\"Xabs\" />\n                </DataItem>\n                <DataItem category=\"CONDITION\" id=\"Xtravel\" type=\"POSITION\" />\n                <DataItem category=\"SAMPLE\" id=\"Xload\" type=\"LOAD\" nativeUnits=\"PERCENT\" units=\"PERCENT\">\n                  <Relationships>\n                    <DataItemRelationship idRef=\"xlcpl\" name=\"archie\" type=\"LIMIT\" />\n                    <SpecificationRelationship idRef=\"spec1\" type=\"LIMIT\" />\n                  </Relationships>\n                </DataItem>\n                <DataItem category=\"SAMPLE\" id=\"Xfrt\" type=\"AXIS_FEEDRATE\" nativeUnits=\"MILLIMETER/SECOND\" units=\"MILLIMETER/SECOND\" />\n                <DataItem category=\"SAMPLE\" id=\"servotemp1\" type=\"TEMPERATURE\" nativeUnits=\"FAHRENHEIT\" units=\"CELSIUS\" compositionId=\"Xmotor\">\n                  <Filters>\n                    <Filter type=\"MINIMUM_DELTA\">0.5</Filter>\n                  </Filters>\n                </DataItem>\n                <DataItem category=\"EVENT\" id=\"xaxisstate\" type=\"AXIS_STATE\" />\n              </DataItems>\n              <Compositions>\n                <Composition id=\"Xballscrew\" type=\"BALLSCREW\" />\n                <Composition id=\"Xmotor\" type=\"MOTOR\" />\n              </Compositions>\n            </Linear>\n            <Linear id=\"y\" name=\"Y\">\n              <DataItems>\n                <DataItem category=\"SAMPLE\" id=\"Yabs\" type=\"POSITION\" subType=\"ACTUAL\" nativeUnits=\"MILLIMETER\" units=\"MILLIMETER\" />\n                <DataItem category=\"SAMPLE\" id=\"Ypos\" type=\"POSITION\" subType=\"ACTUAL\" nativeUnits=\"MILLIMETER\" units=\"MILLIMETER\" />\n                <DataItem category=\"CONDITION\" id=\"Ytravel\" type=\"POSITION\" />\n                <DataItem category=\"SAMPLE\" id=\"Yload\" type=\"LOAD\" nativeUnits=\"PERCENT\" units=\"PERCENT\" />\n                <DataItem category=\"SAMPLE\" id=\"Yfrt\" type=\"AXIS_FEEDRATE\" nativeUnits=\"MILLIMETER/SECOND\" units=\"MILLIMETER/SECOND\" />\n                <DataItem category=\"SAMPLE\" id=\"servotemp2\" type=\"TEMPERATURE\" nativeUnits=\"CELSIUS\" units=\"CELSIUS\" compositionId=\"Ymotor\">\n                  <Filters>\n                    <Filter type=\"MINIMUM_DELTA\">0.5</Filter>\n                  </Filters>\n                </DataItem>\n                <DataItem category=\"EVENT\" id=\"yaxisstate\" type=\"AXIS_STATE\" />\n              </DataItems>\n              <Compositions>\n                <Composition id=\"Yballscrew\" type=\"BALLSCREW\" />\n                <Composition id=\"Ymotor\" type=\"MOTOR\" />\n              </Compositions>\n            </Linear>\n            <Linear id=\"z\" name=\"Z\">\n              <Configuration>\n                <Motion id=\"zax\" coordinateSystemIdRef=\"machine\" type=\"PRISMATIC\" actuation=\"DIRECT\">\n                  <Description>The linears Z kinematics</Description>\n                  <Origin>100 101 102</Origin>\n                  <Axis>0 0.1 1</Axis>\n                </Motion>\n              </Configuration>\n              <DataItems>\n                <DataItem category=\"SAMPLE\" id=\"Zabs\" type=\"POSITION\" subType=\"ACTUAL\" nativeUnits=\"MILLIMETER\" units=\"MILLIMETER\" />\n                <DataItem category=\"SAMPLE\" id=\"Zpos\" type=\"POSITION\" subType=\"ACTUAL\" nativeUnits=\"MILLIMETER\" units=\"MILLIMETER\" />\n                <DataItem category=\"CONDITION\" id=\"Ztravel\" type=\"POSITION\" />\n                <DataItem category=\"SAMPLE\" id=\"Zload\" type=\"LOAD\" nativeUnits=\"PERCENT\" units=\"PERCENT\">\n                  <Filters>\n                    <Filter type=\"MINIMUM_DELTA\">3</Filter>\n                  </Filters>\n                </DataItem>\n                <DataItem category=\"SAMPLE\" id=\"Zfrt\" type=\"AXIS_FEEDRATE\" nativeUnits=\"MILLIMETER/SECOND\" units=\"MILLIMETER/SECOND\" />\n                <DataItem category=\"SAMPLE\" id=\"servotemp3\" type=\"TEMPERATURE\" nativeUnits=\"CELSIUS\" units=\"CELSIUS\" compositionId=\"Zmotor\">\n                  <Filters>\n                    <Filter type=\"MINIMUM_DELTA\">0.5</Filter>\n                  </Filters>\n                </DataItem>\n                <DataItem category=\"EVENT\" id=\"zaxisstate\" type=\"AXIS_STATE\" />\n              </DataItems>\n              <Compositions>\n                <Composition id=\"Zballscrew\" type=\"BALLSCREW\" />\n                <Composition id=\"Zmotor\" type=\"MOTOR\" />\n              </Compositions>\n            </Linear>\n            <Rotary id=\"ar\" name=\"B\">\n              <DataItems>\n                <DataItem category=\"SAMPLE\" id=\"Bload\" type=\"LOAD\" nativeUnits=\"PERCENT\" units=\"PERCENT\">\n                  <Filters>\n                    <Filter type=\"MINIMUM_DELTA\">3</Filter>\n                  </Filters>\n                </DataItem>\n                <DataItem category=\"SAMPLE\" id=\"Bfrt\" type=\"ANGULAR_VELOCITY\" nativeUnits=\"DEGREE/MINUTE\" units=\"DEGREE/SECOND\" />\n                <DataItem category=\"CONDITION\" id=\"Btravel\" type=\"ANGLE\" />\n                <DataItem category=\"SAMPLE\" id=\"Babs\" type=\"ANGLE\" subType=\"ACTUAL\" nativeUnits=\"DEGREE\" units=\"DEGREE\" />\n                <DataItem category=\"SAMPLE\" id=\"Bpos\" type=\"ANGLE\" subType=\"ACTUAL\" nativeUnits=\"DEGREE\" units=\"DEGREE\" />\n                <DataItem category=\"EVENT\" id=\"arfunc\" type=\"ROTARY_MODE\">\n                  <Constraints>\n                    <Value>CONTOUR</Value>\n                    <Value>INDEX</Value>\n                  </Constraints>\n                </DataItem>\n                <DataItem category=\"EVENT\" id=\"baxisstate\" type=\"AXIS_STATE\" />\n              </DataItems>\n              <Compositions>\n                <Composition id=\"Bmotor\" type=\"MOTOR\" />\n              </Compositions>\n            </Rotary>\n            <Rotary id=\"c\" name=\"C\">\n              <Configuration>\n                <Motion id=\"spin\" parentIdRef=\"zax\" coordinateSystemIdRef=\"machine\" type=\"CONTINUOUS\" actuation=\"DIRECT\">\n                  <Description>The spindle kinematics</Description>\n                  <Transformation>\n                    <Translation>10 20 30</Translation>\n                    <Rotation>90 0 180</Rotation>\n                  </Transformation>\n                  <Axis>0 0.5 1</Axis>\n                </Motion>\n                <Relationships>\n                  <ComponentRelationship id=\"ref1\" name=\"Power\" type=\"PEER\" criticality=\"CRITICAL\" idRef=\"power\" />\n                  <DeviceRelationship id=\"ref2\" name=\"coffee\" type=\"PARENT\" criticality=\"NONCRITICAL\" deviceUuidRef=\"bfccbfb0-5111-0138-6cd5-0c85909298d9\" role=\"AUXILIARY\" href=\"http://127.0.0.1:2000/coffee\" />\n                </Relationships>\n                <Specifications>\n                  <Specification id=\"\" name=\"speed_limit\" type=\"ROTARY_VELOCITY\" subType=\"ACTUAL\" dataItemRef=\"c1\" units=\"REVOLUTION/MINUTE\" compositionIdRef=\"cmotor\" coordinateSystemIdRef=\"machine\">\n                    <Maximum>10000</Maximum>\n                    <Nominal>1000</Nominal>\n                    <Minimum>100</Minimum>\n                  </Specification>\n                  <Specification id=\"spec1\" name=\"loadspec\" type=\"LOAD\" units=\"PERCENT\">\n                    <Maximum>1000</Maximum>\n                    <UpperLimit>500</UpperLimit>\n                    <UpperWarning>200</UpperWarning>\n                    <Nominal>100</Nominal>\n                    <LowerLimit>-500</LowerLimit>\n                    <LowerWarning>-200</LowerWarning>\n                    <Minimum>-1000</Minimum>\n                  </Specification>\n                  <ProcessSpecification id=\"pspec1\" name=\"procspec\" type=\"LOAD\" units=\"PERCENT\" originator=\"USER\">\n                    <ControlLimits>\n                      <ControlLimits>\n                        <UpperLimit>500</UpperLimit>\n                        <UpperWarning>200</UpperWarning>\n                        <Nominal>10</Nominal>\n                        <LowerLimit>-500</LowerLimit>\n                        <LowerWarning>-200</LowerWarning>\n                      </ControlLimits>\n                    </ControlLimits>\n                    <SpecificationLimits>\n                      <ControlLimits>\n                        <UpperLimit>500</UpperLimit>\n                        <Nominal>50</Nominal>\n                        <LowerLimit>-500</LowerLimit>\n                      </ControlLimits>\n                    </SpecificationLimits>\n                    <AlarmLimits>\n                      <ControlLimits>\n                        <UpperLimit>500</UpperLimit>\n                        <UpperWarning>200</UpperWarning>\n                        <LowerLimit>-500</LowerLimit>\n                        <LowerWarning>-200</LowerWarning>\n                      </ControlLimits>\n                    </AlarmLimits>\n                  </ProcessSpecification>\n                </Specifications>\n              </Configuration>\n              <DataItems>\n                <DataItem category=\"SAMPLE\" id=\"Cload\" type=\"LOAD\" nativeUnits=\"PERCENT\" units=\"PERCENT\">\n                  <Filters>\n                    <Filter type=\"MINIMUM_DELTA\">3</Filter>\n                  </Filters>\n                </DataItem>\n                <DataItem category=\"SAMPLE\" id=\"Sload\" type=\"LOAD\" nativeUnits=\"PERCENT\" units=\"PERCENT\">\n                  <Filters>\n                    <Filter type=\"MINIMUM_DELTA\">3</Filter>\n                  </Filters>\n                </DataItem>\n                <DataItem category=\"CONDITION\" id=\"Ctravel\" type=\"ANGLE\" />\n                <DataItem category=\"SAMPLE\" id=\"Cfrt\" type=\"ANGULAR_VELOCITY\" nativeUnits=\"DEGREE/MINUTE\" units=\"DEGREE/SECOND\" />\n                <DataItem category=\"SAMPLE\" id=\"Srpm\" type=\"ROTARY_VELOCITY\" subType=\"ACTUAL\" nativeUnits=\"REVOLUTION/MINUTE\" units=\"REVOLUTION/MINUTE\">\n                  <Filters>\n                    <Filter type=\"MINIMUM_DELTA\">5</Filter>\n                  </Filters>\n                </DataItem>\n                <DataItem category=\"SAMPLE\" id=\"Stemp\" type=\"TEMPERATURE\" nativeUnits=\"CELSIUS\" units=\"CELSIUS\" compositionId=\"Cmotor\">\n                  <Filters>\n                    <Filter type=\"MINIMUM_DELTA\">0.5</Filter>\n                  </Filters>\n                </DataItem>\n                <DataItem category=\"SAMPLE\" id=\"Cabs\" type=\"ANGLE\" subType=\"ACTUAL\" nativeUnits=\"DEGREE\" units=\"DEGREE\" />\n                <DataItem category=\"SAMPLE\" id=\"Cpos\" type=\"ANGLE\" subType=\"ACTUAL\" nativeUnits=\"DEGREE\" units=\"DEGREE\" />\n                <DataItem category=\"EVENT\" id=\"crfunc\" type=\"ROTARY_MODE\">\n                  <Constraints>\n                    <Value>SPINDLE</Value>\n                    <Value>INDEX</Value>\n                  </Constraints>\n                </DataItem>\n                <DataItem category=\"CONDITION\" id=\"Sload_cond\" type=\"LOAD\" />\n                <DataItem category=\"CONDITION\" id=\"Stemp_cond\" type=\"TEMPERATURE\" />\n                <DataItem category=\"EVENT\" id=\"caxisstate\" type=\"AXIS_STATE\" />\n              </DataItems>\n              <Compositions>\n                <Composition id=\"Cmotor\" type=\"MOTOR\" />\n              </Compositions>\n            </Rotary>\n          </Components>\n        </Axes>\n        <Controller id=\"cont\" name=\"controller\">\n          <DataItems>\n            <DataItem category=\"CONDITION\" id=\"comms_cond\" type=\"COMMUNICATIONS\" />\n            <DataItem category=\"CONDITION\" id=\"logic_cond\" type=\"LOGIC_PROGRAM\" />\n            <DataItem category=\"CONDITION\" id=\"system_cond\" type=\"SYSTEM\" />\n            <DataItem category=\"EVENT\" id=\"estop\" type=\"EMERGENCY_STOP\" />\n            <DataItem category=\"EVENT\" id=\"pallet_num\" type=\"PALLET_ID\" />\n          </DataItems>\n          <Components>\n            <Path id=\"path1\" name=\"path\">\n              <Configuration>\n                <CoordinateSystems>\n                  <CoordinateSystem id=\"world\" type=\"WORLD\" name=\"worldy\">\n                    <Origin>101 102 103</Origin>\n                  </CoordinateSystem>\n                  <CoordinateSystem id=\"machine\" type=\"MACHINE\" name=\"machiney\" nativeName=\"xxx\" parentIdRefd=\"world\">\n                    <Transformation>\n                      <Translation>10 10 10</Translation>\n                      <Rotation>90 0 90</Rotation>\n                    </Transformation>\n                  </CoordinateSystem>\n                </CoordinateSystems>\n              </Configuration>\n              <DataItems>\n                <DataItem category=\"EVENT\" id=\"peditmode\" type=\"PROGRAM_EDIT\" />\n                <DataItem category=\"EVENT\" id=\"peditname\" type=\"PROGRAM_EDIT_NAME\" />\n                <DataItem category=\"EVENT\" id=\"hd1chuckstate\" type=\"CHUCK_STATE\" />\n                <DataItem category=\"EVENT\" id=\"Frapidovr\" type=\"PATH_FEEDRATE_OVERRIDE\" subType=\"RAPID\" />\n                <DataItem category=\"EVENT\" id=\"Fovr\" type=\"PATH_FEEDRATE_OVERRIDE\" subType=\"PROGRAMMED\" />\n                <DataItem category=\"EVENT\" id=\"Sovr\" type=\"ROTARY_VELOCITY_OVERRIDE\" />\n                <DataItem category=\"EVENT\" id=\"program\" type=\"PROGRAM\" subType=\"MAIN\" />\n                <DataItem category=\"EVENT\" id=\"activeprog\" type=\"PROGRAM\" subType=\"ACTIVE\" />\n                <DataItem category=\"EVENT\" id=\"PartCountAct\" type=\"PART_COUNT\" subType=\"ALL\" />\n                <DataItem category=\"SAMPLE\" id=\"Fact\" type=\"PATH_FEEDRATE\" subType=\"ACTUAL\" nativeUnits=\"MILLIMETER/SECOND\" units=\"MILLIMETER/SECOND\" />\n                <DataItem category=\"EVENT\" id=\"Tool_number\" type=\"TOOL_NUMBER\" />\n                <DataItem category=\"EVENT\" id=\"Tool_group\" type=\"TOOL_GROUP\" />\n                <DataItem category=\"EVENT\" id=\"execution\" type=\"EXECUTION\" />\n                <DataItem category=\"EVENT\" id=\"message\" type=\"MESSAGE\" />\n                <DataItem category=\"EVENT\" id=\"waitstate\" type=\"WAIT_STATE\" />\n                <DataItem category=\"EVENT\" id=\"mode\" type=\"CONTROLLER_MODE\" />\n                <DataItem category=\"EVENT\" id=\"program_cmt\" type=\"PROGRAM_COMMENT\" subType=\"MAIN\" />\n                <DataItem category=\"EVENT\" id=\"activeprogram_cmt\" type=\"PROGRAM_COMMENT\" subType=\"ACTIVE\" />\n                <DataItem category=\"CONDITION\" id=\"motion_cond\" type=\"MOTION_PROGRAM\" />\n                <DataItem category=\"CONDITION\" id=\"path_system\" type=\"SYSTEM\" />\n                <DataItem category=\"EVENT\" id=\"cmomachineaxislock\" type=\"CONTROLLER_MODE_OVERRIDE\" subType=\"MACHINE_AXIS_LOCK\" />\n                <DataItem category=\"EVENT\" id=\"cmosingleblock\" type=\"CONTROLLER_MODE_OVERRIDE\" subType=\"SINGLE_BLOCK\" />\n                <DataItem category=\"EVENT\" id=\"cmodryrun\" type=\"CONTROLLER_MODE_OVERRIDE\" subType=\"DRY_RUN\" />\n                <DataItem category=\"EVENT\" id=\"linelabel\" type=\"LINE_LABEL\" />\n                <DataItem category=\"EVENT\" id=\"linenumber\" type=\"LINE_NUMBER\" subType=\"INCREMENTAL\" />\n                <DataItem category=\"EVENT\" id=\"cvars\" type=\"VARIABLE\" representation=\"DATA_SET\" />\n                <DataItem category=\"SAMPLE\" id=\"cspeed\" type=\"CUTTING_SPEED\" subType=\"ACTUAL\" nativeUnits=\"MILLIMETER/SECOND\" units=\"MILLIMETER/SECOND\" />\n                <DataItem category=\"EVENT\" id=\"workoffsettrans\" type=\"TRANSLATION\" nativeUnits=\"MILLIMETER_3D\" units=\"MILLIMETER_3D\" />\n                <DataItem category=\"EVENT\" id=\"workoffsetrot\" type=\"ROTATION\" nativeUnits=\"DEGREE_3D\" units=\"DEGREE_3D\" />\n                <DataItem category=\"EVENT\" id=\"woffset\" type=\"WORK_OFFSET\" />\n                <DataItem category=\"EVENT\" id=\"activeaxes\" type=\"ACTIVE_AXES\" />\n                <DataItem category=\"SAMPLE\" id=\"pathpos\" type=\"PATH_POSITION\" nativeUnits=\"INCH_3D\" units=\"MILLIMETER_3D\" />\n                <DataItem category=\"SAMPLE\" id=\"orientation\" type=\"ORIENTATION\" nativeUnits=\"DEGREE_3D\" units=\"DEGREE_3D\" />\n                <DataItem category=\"EVENT\" id=\"partnumber\" type=\"PART_UNIQUE_ID\" subType=\"PART_NUMBER\" />\n                <DataItem category=\"EVENT\" id=\"partserialnumber\" type=\"PART_UNIQUE_ID\" subType=\"SERIAL_NUMBER\" />\n                <DataItem category=\"SAMPLE\" id=\"testTimeSeries\" type=\"VARIABLE\" representation=\"TIME_SERIES\" />\n                <DataItem category=\"EVENT\" id=\"testDataSet\" type=\"TOOL_OFFSET\" representation=\"DATA_SET\" />\n                <DataItem category=\"EVENT\" id=\"testTable\" type=\"WORK_OFFSET\" representation=\"TABLE\" />\n                <DataItem category=\"EVENT\" id=\"wp1\" name=\"wpo\" type=\"WORKPIECE_OFFSET\" representation=\"TABLE\">\n                  <Definition>\n                    <EntryDefinitions>\n                      <EntryDefinition key=\"G54\">\n                        <Description>Some Pressure thing</Description>\n                        <CellDefinitions>\n                          <CellDefinition key=\"P\" units=\"PASCAL\" type=\"PRESSURE\">\n                            <Description>Pressure of the P</Description>\n                          </CellDefinition>\n                        </CellDefinitions>\n                      </EntryDefinition>\n                      <EntryDefinition key=\"ADD\" units=\"PERCENT\" type=\"FILL_LEVEL\" />\n                      <EntryDefinition keyType=\"FEATURE_ID\" type=\"UUID\" />\n                    </EntryDefinitions>\n                    <CellDefinitions>\n                      <CellDefinition key=\"X\" units=\"MILLIMETER\" type=\"POSITION\" />\n                      <CellDefinition key=\"Y\" units=\"MILLIMETER\" type=\"POSITION\" />\n                      <CellDefinition key=\"Z\" units=\"MILLIMETER\" type=\"POSITION\" />\n                      <CellDefinition key=\"A\" units=\"DEGREE\" type=\"ANGLE\" />\n                      <CellDefinition key=\"B\" units=\"DEGREE\" type=\"ANGLE\" />\n                      <CellDefinition key=\"C\" units=\"DEGREE\" type=\"ANGLE\">\n                        <Description>Spindle Angle</Description>\n                      </CellDefinition>\n                      <CellDefinition keyType=\"FEATURE_ID\" type=\"UUID\" />\n                    </CellDefinitions>\n                  </Definition>\n                </DataItem>\n              </DataItems>\n            </Path>\n          </Components>\n        </Controller>\n        <Door id=\"door1\" name=\"door\">\n          <DataItems>\n            <DataItem category=\"EVENT\" id=\"doorstate\" type=\"DOOR_STATE\" />\n          </DataItems>\n        </Door>\n        <Systems id=\"systems\" name=\"systems\">\n          <Components>\n            <WorkEnvelope id=\"workenvelope\" name=\"workenvelope\">\n              <DataItems>\n                <DataItem category=\"CONDITION\" id=\"envelope_cond\" type=\"SYSTEM\" />\n              </DataItems>\n            </WorkEnvelope>\n            <Electric id=\"elec\" name=\"electric\">\n              <DataItems>\n                <DataItem category=\"CONDITION\" id=\"electric_cond\" type=\"SYSTEM\" />\n              </DataItems>\n            </Electric>\n            <Hydraulic id=\"hydraulic\" name=\"hydraulic\">\n              <References>\n                <DataItemRef idRef=\"c4\" name=\"chuck\" />\n                <DataItemRef idRef=\"d2\" name=\"door\" />\n                <ComponentRef idRef=\"ele\" name=\"electric\" />\n              </References>\n              <DataItems>\n                <DataItem category=\"CONDITION\" id=\"hydra_cond\" type=\"SYSTEM\" />\n              </DataItems>\n            </Hydraulic>\n            <Coolant id=\"coolant\" name=\"coolant\">\n              <DataItems>\n                <DataItem category=\"CONDITION\" id=\"coolant_cond\" type=\"SYSTEM\" />\n                <DataItem category=\"SAMPLE\" id=\"cooltemp\" type=\"TEMPERATURE\" nativeUnits=\"CELSIUS\" units=\"CELSIUS\">\n                  <Filters>\n                    <Filter type=\"MINIMUM_DELTA\">0.5</Filter>\n                  </Filters>\n                </DataItem>\n                <DataItem category=\"SAMPLE\" id=\"CONCENTRATION\" type=\"CONCENTRATION\" nativeUnits=\"PERCENT\" units=\"PERCENT\" />\n              </DataItems>\n            </Coolant>\n            <Pneumatic id=\"pneumatic\" name=\"pneumatic\">\n              <DataItems>\n                <DataItem category=\"CONDITION\" id=\"pneu_cond\" type=\"SYSTEM\" />\n              </DataItems>\n            </Pneumatic>\n            <Lubrication id=\"lubrication\" name=\"lubrication\">\n              <DataItems>\n                <DataItem category=\"CONDITION\" id=\"lubrication_cond\" type=\"SYSTEM\" />\n              </DataItems>\n            </Lubrication>\n          </Components>\n        </Systems>\n        <Auxiliaries id=\"Aux\" name=\"auxiliaries\">\n          <Components>\n            <Environmental id=\"room\" name=\"environmental\">\n              <DataItems>\n                <DataItem category=\"SAMPLE\" id=\"rmtmp1\" type=\"TEMPERATURE\" nativeUnits=\"CELSIUS\" units=\"CELSIUS\">\n                  <Filters>\n                    <Filter type=\"MINIMUM_DELTA\">0.5</Filter>\n                  </Filters>\n                </DataItem>\n              </DataItems>\n            </Environmental>\n            <Sensor id=\"sensor\" name=\"sensor\">\n              <Configuration>\n                <SensorConfiguration>\n                  <FirmwareVersion>2.02</FirmwareVersion>\n                  <CalibrationDate>2010-05-16T00:00:00.0000000</CalibrationDate>\n                  <NextCalibrationDate>2010-05-16T00:00:00.0000000</NextCalibrationDate>\n                  <CalibrationInitials>WS</CalibrationInitials>\n                  <Channels>\n                    <Channel number=\"1\" name=\"A/D:1\" />\n                  </Channels>\n                </SensorConfiguration>\n              </Configuration>\n              <DataItems>\n                <DataItem category=\"CONDITION\" id=\"senvc\" type=\"VOLTAGE\" />\n                <DataItem category=\"SAMPLE\" id=\"senv\" type=\"VOLTAGE\" subType=\"DIRECT\" units=\"VOLT\" />\n              </DataItems>\n            </Sensor>\n          </Components>\n        </Auxiliaries>\n        <Resources id=\"resources\" name=\"resources\">\n          <Components>\n            <Personnel id=\"personnel\" name=\"personnel\">\n              <DataItems>\n                <DataItem category=\"EVENT\" id=\"operator\" type=\"USER\" />\n              </DataItems>\n            </Personnel>\n            <Materials id=\"materials\" name=\"materials\">\n              <Components>\n                <Stock id=\"procstock\" name=\"stock\">\n                  <DataItems>\n                    <DataItem category=\"EVENT\" id=\"stock\" type=\"MATERIAL\" />\n                  </DataItems>\n                </Stock>\n              </Components>\n            </Materials>\n          </Components>\n        </Resources>\n      </Components>\n    </Device>\n  </Devices>\n</MTConnectDevices>");
            reply.Headers.Clear();
            reply.Headers.Add("Content-Type", "application/xml");
            return reply;
        }

        private static SystemReply DefaultCurrentReply()
        {
            var reply = new SystemReply(200, "<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<MTConnectStreams xmlns=\"urn:mtconnect.org:MTConnectStreams:2.5\" xmlns:m=\"urn:mtconnect.org:MTConnectStreams:2.5\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"\">\n  <Header instanceId=\"1756395673\" version=\"6.7.0.0\" sender=\"NB-5CD242BX56\" bufferSize=\"150000\" firstSequence=\"1\" lastSequence=\"209\" nextSequence=\"210\" deviceModelChangeTime=\"2025-08-28T15:41:13.9985794Z\" creationTime=\"2025-08-28T15:45:50.4685459Z\" />\n  <Streams>\n    <DeviceStream name=\"Mazak\" uuid=\"5fd88408-7811-3c6b-5400-11f4026b6890\">\n      <ComponentStream component=\"Device\" componentId=\"d1\" name=\"Mazak\" uuid=\"5fd88408-7811-3c6b-5400-11f4026b6890\">\n        <Events>\n          <Availability dataItemId=\"avail\" sequence=\"12\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Availability>\n          <FunctionalMode dataItemId=\"functionalmode\" sequence=\"13\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</FunctionalMode>\n          <EquipmentMode dataItemId=\"emloaded\" subType=\"LOADED\" sequence=\"14\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</EquipmentMode>\n          <EquipmentMode dataItemId=\"emworking\" subType=\"WORKING\" sequence=\"15\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</EquipmentMode>\n          <EquipmentMode dataItemId=\"emoperating\" subType=\"OPERATING\" sequence=\"16\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</EquipmentMode>\n          <EquipmentMode dataItemId=\"empowered\" subType=\"POWERED\" sequence=\"17\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</EquipmentMode>\n          <EquipmentMode dataItemId=\"emdelay\" subType=\"DELAY\" sequence=\"18\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</EquipmentMode>\n          <OperatingSystem dataItemId=\"operatingsystem\" sequence=\"19\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</OperatingSystem>\n          <OperatingSystem dataItemId=\"osmfg\" subType=\"MANUFACTURER\" sequence=\"20\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</OperatingSystem>\n          <OperatingSystem dataItemId=\"osversion\" subType=\"VERSION\" sequence=\"21\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</OperatingSystem>\n          <Application dataItemId=\"gui\" sequence=\"22\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Application>\n          <Application dataItemId=\"guimfg\" subType=\"MANUFACTURER\" sequence=\"23\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Application>\n          <Application dataItemId=\"guiversion\" subType=\"VERSION\" sequence=\"24\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Application>\n          <AssetChanged dataItemId=\"d1_asset_chg\" sequence=\"25\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</AssetChanged>\n          <AssetRemoved dataItemId=\"d1_asset_rem\" sequence=\"26\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</AssetRemoved>\n          <AssetCount dataItemId=\"d1_assetCount\" name=\"assetCount\" sequence=\"27\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</AssetCount>\n        </Events>\n      </ComponentStream>\n      <ComponentStream component=\"Axes\" componentId=\"a\" name=\"base\">\n        <Condition>\n          <Unavailable dataItemId=\"servo_cond\" type=\"ACTUATOR\" sequence=\"28\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n          <Unavailable dataItemId=\"spindle_cond\" type=\"SYSTEM\" sequence=\"29\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n        </Condition>\n      </ComponentStream>\n      <ComponentStream component=\"Linear\" componentId=\"x\" name=\"X\">\n        <Samples>\n          <Position dataItemId=\"Xabs\" subType=\"ACTUAL\" sequence=\"30\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Position>\n          <Position dataItemId=\"Xpos\" subType=\"ACTUAL\" sequence=\"31\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Position>\n          <Load dataItemId=\"Xload\" sequence=\"33\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Load>\n          <AxisFeedrate dataItemId=\"Xfrt\" sequence=\"34\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</AxisFeedrate>\n          <Temperature dataItemId=\"servotemp1\" compositionId=\"Xmotor\" sequence=\"35\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Temperature>\n        </Samples>\n        <Events>\n          <AxisState dataItemId=\"xaxisstate\" sequence=\"36\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</AxisState>\n        </Events>\n        <Condition>\n          <Unavailable dataItemId=\"Xtravel\" type=\"POSITION\" sequence=\"32\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n        </Condition>\n      </ComponentStream>\n      <ComponentStream component=\"Linear\" componentId=\"y\" name=\"Y\">\n        <Samples>\n          <Position dataItemId=\"Yabs\" subType=\"ACTUAL\" sequence=\"37\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Position>\n          <Position dataItemId=\"Ypos\" subType=\"ACTUAL\" sequence=\"38\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Position>\n          <Load dataItemId=\"Yload\" sequence=\"40\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Load>\n          <AxisFeedrate dataItemId=\"Yfrt\" sequence=\"41\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</AxisFeedrate>\n          <Temperature dataItemId=\"servotemp2\" compositionId=\"Ymotor\" sequence=\"42\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Temperature>\n        </Samples>\n        <Events>\n          <AxisState dataItemId=\"yaxisstate\" sequence=\"43\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</AxisState>\n        </Events>\n        <Condition>\n          <Unavailable dataItemId=\"Ytravel\" type=\"POSITION\" sequence=\"39\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n        </Condition>\n      </ComponentStream>\n      <ComponentStream component=\"Linear\" componentId=\"z\" name=\"Z\">\n        <Samples>\n          <Position dataItemId=\"Zabs\" subType=\"ACTUAL\" sequence=\"44\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Position>\n          <Position dataItemId=\"Zpos\" subType=\"ACTUAL\" sequence=\"45\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Position>\n          <Load dataItemId=\"Zload\" sequence=\"47\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Load>\n          <AxisFeedrate dataItemId=\"Zfrt\" sequence=\"48\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</AxisFeedrate>\n          <Temperature dataItemId=\"servotemp3\" compositionId=\"Zmotor\" sequence=\"49\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Temperature>\n        </Samples>\n        <Events>\n          <AxisState dataItemId=\"zaxisstate\" sequence=\"50\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</AxisState>\n        </Events>\n        <Condition>\n          <Unavailable dataItemId=\"Ztravel\" type=\"POSITION\" sequence=\"46\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n        </Condition>\n      </ComponentStream>\n      <ComponentStream component=\"Rotary\" componentId=\"ar\" name=\"B\">\n        <Samples>\n          <Load dataItemId=\"Bload\" sequence=\"51\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Load>\n          <AngularVelocity dataItemId=\"Bfrt\" sequence=\"52\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</AngularVelocity>\n          <Angle dataItemId=\"Babs\" subType=\"ACTUAL\" sequence=\"54\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Angle>\n          <Angle dataItemId=\"Bpos\" subType=\"ACTUAL\" sequence=\"55\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Angle>\n        </Samples>\n        <Events>\n          <RotaryMode dataItemId=\"arfunc\" sequence=\"56\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</RotaryMode>\n          <AxisState dataItemId=\"baxisstate\" sequence=\"57\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</AxisState>\n        </Events>\n        <Condition>\n          <Unavailable dataItemId=\"Btravel\" type=\"ANGLE\" sequence=\"53\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n        </Condition>\n      </ComponentStream>\n      <ComponentStream component=\"Rotary\" componentId=\"c\" name=\"C\">\n        <Samples>\n          <Load dataItemId=\"Cload\" sequence=\"58\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Load>\n          <Load dataItemId=\"Sload\" sequence=\"59\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Load>\n          <AngularVelocity dataItemId=\"Cfrt\" sequence=\"61\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</AngularVelocity>\n          <RotaryVelocity dataItemId=\"Srpm\" subType=\"ACTUAL\" sequence=\"62\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</RotaryVelocity>\n          <Temperature dataItemId=\"Stemp\" compositionId=\"Cmotor\" sequence=\"63\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Temperature>\n          <Angle dataItemId=\"Cabs\" subType=\"ACTUAL\" sequence=\"64\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Angle>\n          <Angle dataItemId=\"Cpos\" subType=\"ACTUAL\" sequence=\"65\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Angle>\n        </Samples>\n        <Events>\n          <RotaryMode dataItemId=\"crfunc\" sequence=\"66\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</RotaryMode>\n          <AxisState dataItemId=\"caxisstate\" sequence=\"69\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</AxisState>\n        </Events>\n        <Condition>\n          <Unavailable dataItemId=\"Ctravel\" type=\"ANGLE\" sequence=\"60\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n          <Unavailable dataItemId=\"Sload_cond\" type=\"LOAD\" sequence=\"67\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n          <Unavailable dataItemId=\"Stemp_cond\" type=\"TEMPERATURE\" sequence=\"68\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n        </Condition>\n      </ComponentStream>\n      <ComponentStream component=\"Controller\" componentId=\"cont\" name=\"controller\">\n        <Events>\n          <EmergencyStop dataItemId=\"estop\" sequence=\"73\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</EmergencyStop>\n          <PalletId dataItemId=\"pallet_num\" sequence=\"74\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</PalletId>\n        </Events>\n        <Condition>\n          <Unavailable dataItemId=\"comms_cond\" type=\"COMMUNICATIONS\" sequence=\"70\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n          <Unavailable dataItemId=\"logic_cond\" type=\"LOGIC_PROGRAM\" sequence=\"71\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n          <Unavailable dataItemId=\"system_cond\" type=\"SYSTEM\" sequence=\"72\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n        </Condition>\n      </ComponentStream>\n      <ComponentStream component=\"Path\" componentId=\"path1\" name=\"path\">\n        <Samples>\n          <PathFeedrate dataItemId=\"Fact\" subType=\"ACTUAL\" sequence=\"84\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</PathFeedrate>\n          <CuttingSpeed dataItemId=\"cspeed\" subType=\"ACTUAL\" sequence=\"101\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</CuttingSpeed>\n          <PathPosition dataItemId=\"pathpos\" sequence=\"106\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</PathPosition>\n          <Orientation dataItemId=\"orientation\" sequence=\"107\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Orientation>\n          <VariableTimeSeries dataItemId=\"testTimeSeries\" sequence=\"110\" timestamp=\"2025-08-28T15:41:13.9654346Z\" sampleCount=\"0\">UNAVAILABLE</VariableTimeSeries>\n        </Samples>\n        <Events>\n          <ProgramEdit dataItemId=\"peditmode\" sequence=\"75\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</ProgramEdit>\n          <ProgramEditName dataItemId=\"peditname\" sequence=\"76\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</ProgramEditName>\n          <ChuckState dataItemId=\"hd1chuckstate\" sequence=\"77\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</ChuckState>\n          <PathFeedrateOverride dataItemId=\"Frapidovr\" subType=\"RAPID\" sequence=\"78\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</PathFeedrateOverride>\n          <PathFeedrateOverride dataItemId=\"Fovr\" subType=\"PROGRAMMED\" sequence=\"79\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</PathFeedrateOverride>\n          <RotaryVelocityOverride dataItemId=\"Sovr\" sequence=\"80\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</RotaryVelocityOverride>\n          <Program dataItemId=\"program\" subType=\"MAIN\" sequence=\"81\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Program>\n          <Program dataItemId=\"activeprog\" subType=\"ACTIVE\" sequence=\"82\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Program>\n          <PartCount dataItemId=\"PartCountAct\" subType=\"ALL\" sequence=\"83\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</PartCount>\n          <ToolNumber dataItemId=\"Tool_number\" sequence=\"85\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</ToolNumber>\n          <ToolGroup dataItemId=\"Tool_group\" sequence=\"86\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</ToolGroup>\n          <Execution dataItemId=\"execution\" sequence=\"87\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Execution>\n          <Message dataItemId=\"message\" sequence=\"88\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Message>\n          <WaitState dataItemId=\"waitstate\" sequence=\"89\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</WaitState>\n          <ControllerMode dataItemId=\"mode\" sequence=\"90\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</ControllerMode>\n          <ProgramComment dataItemId=\"program_cmt\" subType=\"MAIN\" sequence=\"91\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</ProgramComment>\n          <ProgramComment dataItemId=\"activeprogram_cmt\" subType=\"ACTIVE\" sequence=\"92\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</ProgramComment>\n          <ControllerModeOverride dataItemId=\"cmomachineaxislock\" subType=\"MACHINE_AXIS_LOCK\" sequence=\"95\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</ControllerModeOverride>\n          <ControllerModeOverride dataItemId=\"cmosingleblock\" subType=\"SINGLE_BLOCK\" sequence=\"96\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</ControllerModeOverride>\n          <ControllerModeOverride dataItemId=\"cmodryrun\" subType=\"DRY_RUN\" sequence=\"97\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</ControllerModeOverride>\n          <LineLabel dataItemId=\"linelabel\" sequence=\"98\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</LineLabel>\n          <LineNumber dataItemId=\"linenumber\" subType=\"INCREMENTAL\" sequence=\"99\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</LineNumber>\n          <VariableDataSet dataItemId=\"cvars\" sequence=\"100\" timestamp=\"2025-08-28T15:41:13.9654346Z\" count=\"0\">UNAVAILABLE</VariableDataSet>\n          <Translation dataItemId=\"workoffsettrans\" sequence=\"102\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Translation>\n          <Rotation dataItemId=\"workoffsetrot\" sequence=\"103\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Rotation>\n          <WorkOffset dataItemId=\"woffset\" sequence=\"104\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</WorkOffset>\n          <ActiveAxes dataItemId=\"activeaxes\" sequence=\"105\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</ActiveAxes>\n          <PartUniqueId dataItemId=\"partnumber\" subType=\"PART_NUMBER\" sequence=\"108\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</PartUniqueId>\n          <PartUniqueId dataItemId=\"partserialnumber\" subType=\"SERIAL_NUMBER\" sequence=\"109\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</PartUniqueId>\n          <ToolOffsetDataSet dataItemId=\"testDataSet\" sequence=\"111\" timestamp=\"2025-08-28T15:41:13.9654346Z\" count=\"0\">UNAVAILABLE</ToolOffsetDataSet>\n          <WorkOffsetTable dataItemId=\"testTable\" sequence=\"112\" timestamp=\"2025-08-28T15:41:13.9654346Z\" count=\"0\">UNAVAILABLE</WorkOffsetTable>\n          <WorkpieceOffsetTable dataItemId=\"wp1\" name=\"wpo\" sequence=\"113\" timestamp=\"2025-08-28T15:41:13.9654346Z\" count=\"0\">UNAVAILABLE</WorkpieceOffsetTable>\n        </Events>\n        <Condition>\n          <Unavailable dataItemId=\"motion_cond\" type=\"MOTION_PROGRAM\" sequence=\"93\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n          <Unavailable dataItemId=\"path_system\" type=\"SYSTEM\" sequence=\"94\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n        </Condition>\n      </ComponentStream>\n      <ComponentStream component=\"Door\" componentId=\"door1\" name=\"door\">\n        <Events>\n          <DoorState dataItemId=\"doorstate\" sequence=\"114\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</DoorState>\n        </Events>\n      </ComponentStream>\n      <ComponentStream component=\"WorkEnvelope\" componentId=\"workenvelope\" name=\"workenvelope\">\n        <Condition>\n          <Unavailable dataItemId=\"envelope_cond\" type=\"SYSTEM\" sequence=\"115\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n        </Condition>\n      </ComponentStream>\n      <ComponentStream component=\"Electric\" componentId=\"elec\" name=\"electric\">\n        <Condition>\n          <Unavailable dataItemId=\"electric_cond\" type=\"SYSTEM\" sequence=\"116\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n        </Condition>\n      </ComponentStream>\n      <ComponentStream component=\"Hydraulic\" componentId=\"hydraulic\" name=\"hydraulic\">\n        <Condition>\n          <Unavailable dataItemId=\"hydra_cond\" type=\"SYSTEM\" sequence=\"117\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n        </Condition>\n      </ComponentStream>\n      <ComponentStream component=\"Coolant\" componentId=\"coolant\" name=\"coolant\">\n        <Samples>\n          <Temperature dataItemId=\"cooltemp\" sequence=\"119\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Temperature>\n          <Concentration dataItemId=\"CONCENTRATION\" sequence=\"120\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Concentration>\n        </Samples>\n        <Condition>\n          <Unavailable dataItemId=\"coolant_cond\" type=\"SYSTEM\" sequence=\"118\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n        </Condition>\n      </ComponentStream>\n      <ComponentStream component=\"Pneumatic\" componentId=\"pneumatic\" name=\"pneumatic\">\n        <Condition>\n          <Unavailable dataItemId=\"pneu_cond\" type=\"SYSTEM\" sequence=\"121\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n        </Condition>\n      </ComponentStream>\n      <ComponentStream component=\"Lubrication\" componentId=\"lubrication\" name=\"lubrication\">\n        <Condition>\n          <Unavailable dataItemId=\"lubrication_cond\" type=\"SYSTEM\" sequence=\"122\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n        </Condition>\n      </ComponentStream>\n      <ComponentStream component=\"Environmental\" componentId=\"room\" name=\"environmental\">\n        <Samples>\n          <Temperature dataItemId=\"rmtmp1\" sequence=\"123\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Temperature>\n        </Samples>\n      </ComponentStream>\n      <ComponentStream component=\"Sensor\" componentId=\"sensor\" name=\"sensor\">\n        <Samples>\n          <Voltage dataItemId=\"senv\" subType=\"DIRECT\" sequence=\"125\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Voltage>\n        </Samples>\n        <Condition>\n          <Unavailable dataItemId=\"senvc\" type=\"VOLTAGE\" sequence=\"124\" timestamp=\"2025-08-28T15:41:13.9654346Z\" />\n        </Condition>\n      </ComponentStream>\n      <ComponentStream component=\"Personnel\" componentId=\"personnel\" name=\"personnel\">\n        <Events>\n          <User dataItemId=\"operator\" sequence=\"126\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</User>\n        </Events>\n      </ComponentStream>\n      <ComponentStream component=\"Stock\" componentId=\"procstock\" name=\"stock\">\n        <Events>\n          <Material dataItemId=\"stock\" sequence=\"127\" timestamp=\"2025-08-28T15:41:13.9654346Z\">UNAVAILABLE</Material>\n        </Events>\n      </ComponentStream>\n    </DeviceStream>\n  </Streams>\n</MTConnectStreams>");
            reply.Headers.Clear();
            reply.Headers.Add("Content-Type", "application/xml");
            return reply;
        }
    }
}
